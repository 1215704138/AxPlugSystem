cmake_minimum_required(VERSION 3.15)



# é¡¹ç›®åç§°å’Œç‰ˆæœ¬

project(AxPlug VERSION 1.0.0 LANGUAGES CXX)



# è®¾ç½® CMake ç­–ç•¥æ¥æŠ‘åˆ¶è­¦å‘Š

if(POLICY CMP0074)

    cmake_policy(SET CMP0074 NEW)

endif()



# å¼ºåˆ¶ä½¿ç”¨ C++17

set(CMAKE_CXX_STANDARD 17)


set(CMAKE_CXX_STANDARD_REQUIRED ON)

# ç”Ÿæˆ compile_commands.json ç”¨äº IDE æ™ºèƒ½æç¤º
set(CMAKE_EXPORT_COMPILE_COMMANDS ON)




# è®¾ç½®æ„å»ºç±»å‹ä¸º Debug (ç”¨äºè°ƒè¯•)

if(NOT CMAKE_BUILD_TYPE)

    set(CMAKE_BUILD_TYPE Debug)

endif()

# ğŸ”§ è®¾ç½®æ ‡å‡†è¿è¡Œæ—¶åº“ (ç¡®ä¿è·¨DLLè°ƒç”¨å…¼å®¹æ€§)
if(MSVC)
    set(CMAKE_MSVC_RUNTIME_LIBRARY "MultiThreaded$<$<CONFIG:Debug>:Debug>DLL")
    add_compile_definitions(NOMINMAX)
endif()

# æŠ‘åˆ¶ MSVC STL æ‰©å±•è­¦å‘Š

add_compile_definitions(

    _SILENCE_STDEXT_ARR_ITERS_DEPRECATION_WARNING

    _SILENCE_ALL_MS_EXT_DEPRECATION_WARNINGS

)

# ä¸ºæ‰€æœ‰æ’ä»¶é¡¹ç›®è®¾ç½®å¯¼å‡ºå®
function(setup_plugin_target target_name)
    target_compile_definitions(${target_name} PRIVATE AX_PLUGIN_EXPORTS)
endfunction()



# ä¿®å¤ç¼–ç é—®é¢˜

if(MSVC)

    add_compile_options(/utf-8)

endif()



# è®¾ç½®å…¨å±€è¾“å‡ºç›®å½• - ç»Ÿä¸€åˆ° bin/Debug

set(CMAKE_RUNTIME_OUTPUT_DIRECTORY "${CMAKE_BINARY_DIR}/bin/Debug")

set(CMAKE_LIBRARY_OUTPUT_DIRECTORY "${CMAKE_BINARY_DIR}/bin/Debug")

set(CMAKE_ARCHIVE_OUTPUT_DIRECTORY "${CMAKE_BINARY_DIR}/bin/Debug")



# ä¸ºå¤šé…ç½®ç”Ÿæˆå™¨è®¾ç½®è¾“å‡ºç›®å½•

set(CMAKE_RUNTIME_OUTPUT_DIRECTORY_DEBUG "${CMAKE_BINARY_DIR}/bin/Debug")

set(CMAKE_LIBRARY_OUTPUT_DIRECTORY_DEBUG "${CMAKE_BINARY_DIR}/bin/Debug")

set(CMAKE_ARCHIVE_OUTPUT_DIRECTORY_DEBUG "${CMAKE_BINARY_DIR}/bin/Debug")



set(CMAKE_RUNTIME_OUTPUT_DIRECTORY_RELEASE "${CMAKE_BINARY_DIR}/bin/Release")

set(CMAKE_LIBRARY_OUTPUT_DIRECTORY_RELEASE "${CMAKE_BINARY_DIR}/bin/Release")

set(CMAKE_ARCHIVE_OUTPUT_DIRECTORY_RELEASE "${CMAKE_BINARY_DIR}/bin/Release")



# --- åŒ…å« FetchContent æ¨¡å— ---

include(FetchContent)

# --- è¾“å‡ºç›®å½•ç®¡ç† ---

set(CMAKE_ARCHIVE_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/lib) # .lib æ–‡ä»¶

set(CMAKE_LIBRARY_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/bin) # .dll æ–‡ä»¶

set(CMAKE_RUNTIME_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/bin) # .exe æ–‡ä»¶



# --- å®šä¹‰å…¬å…±æ¥å£åº“ (Header-only) ---

add_library(AxInterface INTERFACE)

target_include_directories(AxInterface INTERFACE 

    ${CMAKE_SOURCE_DIR}/include

    ${CMAKE_SOURCE_DIR}/include/core

    ${CMAKE_SOURCE_DIR}/include/driver

    ${CMAKE_SOURCE_DIR}/include/business

)



# --- æ·»åŠ å­æ¨¡å— ---

add_subdirectory(src/AxCore)

add_subdirectory(src/core/LoggerService)

add_subdirectory(src/business/MathPlugin)

add_subdirectory(src/driver/TcpClient)

add_subdirectory(src/driver/TcpServer)

add_subdirectory(src/driver/UdpSocket)

add_subdirectory(src/core/ImageUnifyService)





# --- æ‰“å°é…ç½®ä¿¡æ¯ ---

message(STATUS "=== AxPlug Configuration ===")

message(STATUS "Build Type: ${CMAKE_BUILD_TYPE}")

message(STATUS "C++ Standard: ${CMAKE_CXX_STANDARD}")

message(STATUS "Compiler: ${CMAKE_CXX_COMPILER_ID}")



message(STATUS "Output Directory: ${CMAKE_RUNTIME_OUTPUT_DIRECTORY}")

message(STATUS "=============================")


# --- å®‰è£…/å‘å¸ƒé…ç½® ---

if(CMAKE_INSTALL_PREFIX_INITIALIZED_TO_DEFAULT)
    set(CMAKE_INSTALL_PREFIX "${CMAKE_SOURCE_DIR}/publish" CACHE PATH "Default install prefix" FORCE)
endif()

# å®‰è£…å¤´æ–‡ä»¶
install(DIRECTORY include/ DESTINATION include)

# --- æ·»åŠ æµ‹è¯•å­ç›®å½• ---
option(AXPLUG_BUILD_TESTS "Build AxPlug tests" ON)

if(AXPLUG_BUILD_TESTS AND EXISTS "${CMAKE_SOURCE_DIR}/test")
    add_subdirectory(test)
endif()


